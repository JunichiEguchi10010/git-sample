WordPress ログインできなくなった時に使えるコードおよび対策　20250605

下記のコードをfunctions.phpに追加してページを更新すると「admin」という新規アカウントを追加できます。

ログイン情報
ID: admin
PASS: pass

ユーザー追加
add_action('init', function() {
    if (!username_exists('admin')) {
        $user_id = wp_create_user('admin', 'pass', 'newadmin@example.com');
        $user = new WP_User($user_id);
        $user->set_role('administrator');
    }
});

add_action('init', function() {


✅コード解説
add_action('init', …) は WordPress の「init」イベントが発生した時に指定した関数を実行する仕組みです。
つまり、WordPressが読み込まれたタイミングでこの処理が実行されます。

その後、無名関数（function() { ... }）を定義して、処理内容を記述しています。

if (!username_exists('admin')) {
username_exists('admin') は WordPress 内に「admin」というユーザー名のアカウントが存在するかを確認します。
!username_exists('admin') の「!」は否定（NOT）を意味し、「admin」が存在しない場合のみ次の処理を実行します。

$user_id = wp_create_user('admin', 'pass', 'newadmin@example.com');
wp_create_user(ユーザー名, パスワード, メールアドレス) で新規ユーザーを作成します。
admin というユーザー名、pass というパスワード、newadmin@example.com というメールアドレスで作成します。
生成されたユーザーのIDが $user_id に格納されます。

$user = new WP_User($user_id);
作成したユーザーの情報を取得し、$user という変数に格納します。
WP_User は WordPress のユーザーデータを扱うためのクラスです。

$user->set_role('administrator');
$user->set_role('administrator') で、このユーザーの権限を「管理者（administrator）」に設定します。

これにより、新しく作成された「admin」ユーザーは WordPress の管理画面にフルアクセスできます。

}（閉じカッコ）
if文の処理がここで終了します。

});（関数の閉じカッコ）
無名関数が終わり、add_action に登録された処理が完了します。

❗注意点
このコードを追加すると、新規管理者アカウントが作成されますが、
簡単なパスワード（pass）を使用しているため セキュリティ的に危険 です。
functions.phpに追加したままだと 不正アクセスのリスク がありますので、アカウント作成後は すぐにコードを削除 することをおすすめします。
必要ならば、強固なパスワードを生成する処理を追加するのも良いでしょう。


✅WordPressにログインできない状態でfunctions.phpを編集する方法

🟨FTPクライアントを使う
FileZillaなどのFTPソフトを使ってWordPressのファイルにアクセスできます。
wp-content/themes/使用中のテーマ/functions.php を開いて編集します。

🟨レンタルサーバーのファイルマネージャーを使う
サーバーの管理画面（cPanelなど）には、ブラウザ上でファイルを編集できる機能があります。
ファイルマネージャーでfunctions.phpを編集してコードを追加。

🟨SSH接続で編集する（上級者向け）
サーバーにSSHで接続し、nano や vim などのコマンドを使ってfunctions.phpを編集できます。


🟨編集後の注意
ユーザー追加後は必ずfunctions.phpのコードを削除しましょう！
admin という名前は一般的すぎてセキュリティリスクが高いため、別のユーザー名にするのが安全です。

🟨なぜ削除する必要があるのか？
セキュリティリスク: コードを残したままにすると、悪意のあるユーザーがfunctions.phpを再実行して不正なアカウントを作成する可能性があります。

不要な処理: このコードは「admin」というユーザーが存在しない場合にのみ実行されますが、ログインできるようになった後は不要です。

テーマファイルの安全性: functions.phpはテーマの一部なので、変更を加えたままにすると、将来的なテーマ更新時に予期しない動作を引き起こす可能性があります。

🟨安全な方法
新しく作成した管理者アカウントでWordPressにログイン。

ダッシュボードの「外観」→「テーマファイルエディター」へ移動。

functions.phpのコードを削除して保存。

必要に応じて、セキュリティ対策（パスワードの変更やログイン制限）を行う。


✅WordPressの管理者アカウントにログインできない場合とは？

🟨このコードを使うべきケース
管理者アカウントのパスワードを忘れた
WordPressの「パスワードをリセット」機能がうまく動作しない場合に利用できます。

管理者アカウントが削除された
何らかの理由で管理者権限を持つアカウントが削除されてしまった場合、新しい管理者アカウントを追加できます。

サイトが乗っ取られた / アクセスできなくなった
悪意ある攻撃により管理者アカウントのアクセス権が変更された場合、復旧手段の一つとして利用できます。

データベースが壊れてアカウントが見えなくなった
データベースの不具合でユーザー情報が壊れ、ログインできなくなった場合に新しい管理者アカウントを追加して対応できます。

🟨このコードを使わないほうがよいケース
通常のパスワードリセットができる場合 → WordPressの「パスワードを忘れた」機能を優先

他の管理者がいる場合 → 既存の管理者にパスワードをリセットしてもらう

セキュリティリスクを避けたい場合 → functions.phpに直接追加すると危険なので、一時的に追加してすぐ削除するのが安全です

この方法は 最終手段 なので、他の方法で解決できる場合はそちらを優先すること。


✅他の管理者がいる場合
① 他の管理者にパスワードをリセットしてもらう
管理者ユーザーはダッシュボードから他のユーザーのパスワードをリセットできます。 

手順：
他の管理者にお願いして ダッシュボードにログインしてもらう。
「ユーザー」→「ユーザー一覧」を開く。
あなたのアカウントを選び、「パスワードを変更」または「新しいパスワードを設定」を行ってもらう。
設定されたパスワードでログイン。

② WordPressの「パスワードを忘れた」機能を使う
ログイン画面の「パスワードを忘れた場合」リンクから、登録メールアドレスを使ってパスワードリセットできます。 ただし、メールが届かない場合は メール設定の不具合 や サーバー側の問題 の可能性があるため、他の方法を検討しましょう。

③ データベースから管理者アカウントを修正
もし他の管理者が対応できない場合は、直接データベースを編集してアカウントを復旧する方法があります。 手順：
サーバーの phpMyAdmin にログイン。
WordPressの wp_users テーブルを開く。
自分のユーザー名を探し、パスワードの部分（user_pass）を変更する。
パスワードは MD5ハッシュ化 されているため、直接入力せずツールを使って変換する。

④ サーバーのバックアップを確認
もしログインできない原因が 管理者アカウントの削除 であれば、サーバーのバックアップから以前の状態に復元できる場合もあります。 
レンタルサーバーの管理画面でバックアップ機能を確認してみてください。


✅WordPressのパスワードをリセットする方法

方法①: WordPressの「パスワードを忘れた」機能を使う
WordPressのログイン画面 (https://example.com/wp-login.php) を開く。
「パスワードをお忘れですか？」をクリック。
ユーザー名または登録したメールアドレスを入力し、「新しいパスワードを取得」をクリック。
メールが送信されるので、受信ボックスを確認。
メール内のリンクをクリックし、新しいパスワードを設定。
設定完了後、新しいパスワードでログイン。

💡 注意: メールが届かない場合は、スパムフォルダをチェックしたり、サーバーのメール設定を確認してみましょう。

方法②: phpMyAdminでデータベースを編集する
レンタルサーバーの管理画面にログインし、phpMyAdmin を開く。
wp_users テーブルを選択し、管理者ユーザーの情報を探す。
user_pass の値を MD5 形式で新しいパスワードに変更する。
例: 123456 を e10adc3949ba59abbe56e057f20f883e に変換
変更を保存し、WordPressに新しいパスワードでログイン。

💡 注意: MD5は暗号化ではなくハッシュ化なので、セキュリティ強化のためログイン後にWordPressの設定画面から新しいパスワードを設定しましょう。

方法③: FTPでfunctions.phpを編集する
FTPクライアント (FileZillaなど) を使ってサーバーに接続。
wp-content/themes/使用中のテーマ/functions.php を開く。
以下のコードを追加してページを更新すると、新しい管理者アカウントを作成できる。

php
add_action('init', function() {
    if (!username_exists('admin')) {
        $user_id = wp_create_user('admin', 'pass123', 'admin@example.com');
        $user = new WP_User($user_id);
        $user->set_role('administrator');
    }
});
WordPressに admin / pass123 でログイン。

ログイン後はfunctions.phpのコードを必ず削除！

💡 注意: この方法は緊急対応用なので、ログインできたらすぐに強固なパスワードを設定し、ユーザー名も変更することをおすすめします。



