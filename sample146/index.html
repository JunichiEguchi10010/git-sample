<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>thisã®æŒ™å‹•ãƒ‡ãƒ¢</title>
<!-- CSSã‚¹ã‚¿ã‚¤ãƒ«å®šç¾© -->
<style>
  /* åŸºæœ¬ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
  body { font-family: Arial, sans-serif; margin: 20px; }
  h1 { font-size: 1.4em; margin-bottom: 10px; }
  
  /* ã‚±ãƒ¼ã‚¹è¡¨ç¤ºç”¨ã®ã‚¹ã‚¿ã‚¤ãƒ« */
  .case { margin-bottom: 20px; padding: 10px; border-left: 5px solid #ccc; background: #f9f9f9; }
  .result { font-weight: bold; padding: 5px 8px; display: inline-block; border-radius: 4px; margin-top:6px; }
  .ok { background-color: #d4edda; color: #155724; }  /* æˆåŠŸæ™‚ã®ã‚¹ã‚¿ã‚¤ãƒ« */
  .ng { background-color: #f8d7da; color: #721c24; }   /* å¤±æ•—æ™‚ã®ã‚¹ã‚¿ã‚¤ãƒ« */
  .desc { margin-top: 8px; font-size: 0.95em; color: #333; }
  
  /* ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ã®ã‚¹ã‚¿ã‚¤ãƒ« */
  pre { background: #eee; padding: 8px; border-radius: 4px; overflow-x: auto; margin-top: 8px; white-space: pre-wrap; }
  mark { background: yellow; padding: 0 2px; }
  
  /* ãƒãƒ¼ã‚«ãƒ¼ã®å…‰ã‚‹ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
  .highlight { animation: glow 1.2s ease-out forwards; }
  @keyframes glow {
    0% { box-shadow: 0 0 8px 3px rgba(255,235,59,0.9); }
    50% { box-shadow: 0 0 6px 2px rgba(255,241,118,0.6); }
    100% { box-shadow: none; }
  }
  
  /* ãƒœã‚¿ãƒ³ã‚¹ã‚¿ã‚¤ãƒ« */
  button { padding: 8px 12px; font-size: 1em; cursor: pointer; margin-top:10px; }
</style>
</head>
<body>
<h1>JavaScript this ã®æŒ™å‹•ãƒ‡ãƒ¢</h1>

<!-- èª¬æ˜ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
<div style="background:#e3f2fd; border-left: 5px solid #42a5f5; padding:12px; margin-bottom:20px; line-height:1.5;">
    <p><strong>this ã¨ã¯ï¼Ÿ</strong><br>
    ã€Œé–¢æ•°ãŒå®Ÿè¡Œã•ã‚Œã‚‹ã¨ãã«ã€è‡ªå‹•çš„ã«æ¸¡ã•ã‚Œã‚‹ç‰¹åˆ¥ãªå€¤ã€ã§ã™ã€‚<br>
    é–¢æ•°ã®ä¸­ã§ <code>this</code> ã¨æ›¸ãã¨ã€ãã®é–¢æ•°ã‚’å‘¼ã³å‡ºã—ãŸã€Œä¸»ä½“ï¼ˆå‘¼ã³å‡ºã—å…ƒã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼‰ã€ã‚’æŒ‡ã—ã¾ã™ã€‚<br>
    ã“ã‚Œã¯å¤‰æ•°ã®ã‚ˆã†ã«è¦‹ãˆã¾ã™ãŒã€ã‚ãã¾ã§å‘¼ã³å‡ºã—æ™‚ã«æ±ºã¾ã‚‹ç‰¹åˆ¥ãªã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã§ã€æ™®é€šã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>
  
    <p><strong>ğŸ’¡ ãƒã‚¤ãƒ³ãƒˆ</strong><br>
    ğŸŸ¦ <em>ã©ã“ã§å®£è¨€ã•ã‚ŒãŸã‹ã§ã¯ãªãã€ã©ã†å‘¼ã³å‡ºã•ã‚ŒãŸã‹ã§æ±ºã¾ã‚‹</em></p>
  </div>

<!-- çµæœè¡¨ç¤ºã‚¨ãƒªã‚¢ -->
<div id="output"></div>
<!-- ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ãƒ¼ãƒ†ã‚¹ãƒˆç”¨ãƒœã‚¿ãƒ³ -->
<button id="btn">ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã§ç¢ºèª</button>

<!-- JavaScript ã‚³ãƒ¼ãƒ‰ -->
<script>
"use strict"; // strictãƒ¢ãƒ¼ãƒ‰ã‚’æœ‰åŠ¹åŒ–

// DOMèª­ã¿è¾¼ã¿å®Œäº†å¾Œã«å®Ÿè¡Œ
document.addEventListener("DOMContentLoaded", () => {
  // DOMè¦ç´ ã®å–å¾—
  const output = document.getElementById("output");
  const btn = document.getElementById("btn");

  /**
   * ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã‚’è¡¨ç¤ºã™ã‚‹é–¢æ•°
   * @param {string} title - ã‚±ãƒ¼ã‚¹ã®ã‚¿ã‚¤ãƒˆãƒ«
   * @param {string} actual - å®Ÿéš›ã®çµæœ
   * @param {string} expected - æœŸå¾…ã•ã‚Œã‚‹çµæœ
   * @param {string} description - èª¬æ˜æ–‡
   * @param {string} codeHtml - ã‚³ãƒ¼ãƒ‰ä¾‹ï¼ˆHTMLå½¢å¼ï¼‰
   * @returns {HTMLElement} ä½œæˆã•ã‚ŒãŸã‚±ãƒ¼ã‚¹è¦ç´ 
   */
  function addCase(title, actual, expected, description, codeHtml) {
    // ã‚±ãƒ¼ã‚¹ç”¨ã®ã‚³ãƒ³ãƒ†ãƒŠè¦ç´ ã‚’ä½œæˆ
    const caseDiv = document.createElement("div");
    caseDiv.className = "case";

    // ã‚¿ã‚¤ãƒˆãƒ«è¦ç´ ã‚’ä½œæˆ
    const heading = document.createElement("div");
    heading.textContent = title;
    caseDiv.appendChild(heading);

    // çµæœè¡¨ç¤ºè¦ç´ ã‚’ä½œæˆ
    const resultSpan = document.createElement("div");
    resultSpan.className = "result";
    const aStr = String(actual);
    
    // æœŸå¾…å€¤ã¨æ¯”è¼ƒã—ã¦ã‚¹ã‚¿ã‚¤ãƒ«ã‚’è¨­å®š
    if (aStr === expected) {
      resultSpan.classList.add("ok");
      resultSpan.textContent = aStr;
    } else {
      resultSpan.classList.add("ng");
      resultSpan.textContent = aStr;
    }
    caseDiv.appendChild(resultSpan);

    // èª¬æ˜æ–‡è¦ç´ ã‚’ä½œæˆ
    const descDiv = document.createElement("div");
    descDiv.className = "desc";
    descDiv.textContent = description;
    caseDiv.appendChild(descDiv);

    // ã‚³ãƒ¼ãƒ‰ä¾‹è¦ç´ ã‚’ä½œæˆ
    const codeBlock = document.createElement("pre");
    codeBlock.innerHTML = codeHtml;
    caseDiv.appendChild(codeBlock);

    // çµæœè¡¨ç¤ºã‚¨ãƒªã‚¢ã«è¿½åŠ 
    output.appendChild(caseDiv);
    return caseDiv;
  }

  // ===== ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰æ™‚ã®ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ =====
  
  // ã‚±ãƒ¼ã‚¹1: ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ã§ã®this
  function globalFunc() { return this; }
  addCase(
    "1. ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°",
    `çµæœï¼š${String(globalFunc())}ï¼ˆæœŸå¾…ã©ãŠã‚Šï¼‰`,
    "çµæœï¼šundefinedï¼ˆæœŸå¾…ã©ãŠã‚Šï¼‰",
    "strict ãƒ¢ãƒ¼ãƒ‰ã§ã¯ã€ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°å†…ã® this ã¯ undefinedï¼ˆéstrictãªã‚‰ windowã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ:ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ã“ã¨ï¼‰ã€‚",
    `function globalFunc() {
  return <mark>this</mark>;
}
globalFunc(); // strictãƒ¢ãƒ¼ãƒ‰ã§ã¯ <mark>undefined</mark>`
  );

  // ã‚±ãƒ¼ã‚¹2: ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ¡ã‚½ãƒƒãƒ‰ã§ã®this
  const person = {
    name: "å¤ªéƒ",
    greet() { return this.name; }
  };
  addCase(
    "2. ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ¡ã‚½ãƒƒãƒ‰",
    `çµæœï¼š${person.greet()}ï¼ˆæœŸå¾…ã©ãŠã‚Šï¼‰`,
    "çµæœï¼šå¤ªéƒï¼ˆæœŸå¾…ã©ãŠã‚Šï¼‰",
    "ãƒ¡ã‚½ãƒƒãƒ‰å‘¼ã³å‡ºã—ã§ã¯ this ã¯ãã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã‚“ã ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼ˆã“ã“ã§ã¯ personï¼‰ã€‚",
    `const person = {
  name: "å¤ªéƒ",
  greet() { return <mark>this.name</mark>; }
};
person.greet(); // "å¤ªéƒ"`
  );

  // ã‚±ãƒ¼ã‚¹3: é–¢æ•°ã‚’å¤‰æ•°ã«ä»£å…¥ã—ã¦å‘¼ã³å‡ºã—ãŸå ´åˆ
  addCase(
    "3. é–¢æ•°ã‚’ä»£å…¥ã—ã¦å‘¼ã¶ï¼ˆthis ãŒå¤‰ã‚ã‚‹ï¼‰",
    (() => {
      try {
        const greetFn = person.greet;
        const result = greetFn();
        return `çµæœï¼š${String(result)}ï¼ˆæœŸå¾…ã©ãŠã‚Šï¼‰`;
      } catch (e) {
        return "ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿï¼š" + e.message;
      }
    })(),
    "çµæœï¼šundefinedï¼ˆæœŸå¾…ã©ãŠã‚Šï¼‰",
    "é–¢æ•°ã‚’ç›´æ¥å‘¼ã¶ã¨ï¼ˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ¡ã‚½ãƒƒãƒ‰ã§ã¯ãªãï¼‰ this ã¯ã‚°ãƒ­ãƒ¼ãƒãƒ«/undefined ã«ãªã‚‹ã€‚",
    `const greetFn = person.greet;
greetFn(); // strictãƒ¢ãƒ¼ãƒ‰ã§ã¯ <mark>undefined</mark>`
  );

  // ã‚±ãƒ¼ã‚¹4: bind()ã§thisã‚’å›ºå®š
  const boundGreet = person.greet.bind(person);
  addCase(
    "4. bind ã§ this ã‚’å›ºå®š",
    `çµæœï¼š${boundGreet()}ï¼ˆæœŸå¾…ã©ãŠã‚Šï¼‰`,
    "çµæœï¼šå¤ªéƒï¼ˆæœŸå¾…ã©ãŠã‚Šï¼‰",
    "bind ã§ this ã‚’å›ºå®šã™ã‚‹ã¨ã€ã©ã“ã§å‘¼ã‚“ã§ã‚‚å›ºå®šã•ã‚ŒãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å‚ç…§ã™ã‚‹ã€‚",
    `const bound = person.greet.bind(person);
bound(); // <mark>"å¤ªéƒ"</mark>`
  );

  // ã‚±ãƒ¼ã‚¹5: é€šå¸¸é–¢æ•°ã¨ã‚¢ãƒ­ãƒ¼é–¢æ•°ã®æ¯”è¼ƒ
  const obj = {
    name: "èŠ±å­",
    regular: function() { return this.name; },  // é€šå¸¸é–¢æ•°
    arrow: () => { return this.name; }          // ã‚¢ãƒ­ãƒ¼é–¢æ•°
  };
  
  // ã‚±ãƒ¼ã‚¹5-1: ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå†…ã®é€šå¸¸é–¢æ•°
  addCase(
    "5-1. ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå†…ã®é€šå¸¸é–¢æ•°",
    `çµæœï¼š${obj.regular()}ï¼ˆæœŸå¾…ã©ãŠã‚Šï¼‰`,
    "çµæœï¼šèŠ±å­ï¼ˆæœŸå¾…ã©ãŠã‚Šï¼‰",
    "é€šå¸¸é–¢æ•°ã¯å‘¼ã³å‡ºã—å…ƒã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ this ã«ã™ã‚‹ï¼ˆã“ã“ã§ã¯ objï¼‰ã€‚",
    `const obj = {
  name: "èŠ±å­",
  regular: function() { return <mark>this.name</mark>; }
};
obj.regular(); // "èŠ±å­"`
  );
  
  // ã‚±ãƒ¼ã‚¹5-2: ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå†…ã®ã‚¢ãƒ­ãƒ¼é–¢æ•°
  addCase(
    "5-2. ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå†…ã®ã‚¢ãƒ­ãƒ¼é–¢æ•°",
    `çµæœï¼š${String(obj.arrow())}ï¼ˆæœŸå¾…ã©ãŠã‚Šï¼‰`,
    "çµæœï¼šundefinedï¼ˆæœŸå¾…ã©ãŠã‚Šï¼‰",
    "ã‚¢ãƒ­ãƒ¼é–¢æ•°ã¯è‡ªåˆ†ã® this ã‚’æŒãŸãšå¤–å´ã‚’å‚ç…§ã™ã‚‹ãŸã‚ã€ã“ã“ã§ã¯æœŸå¾…é€šã‚Šã® obj ã‚’å‚ç…§ã—ãªã„ã€‚",
    `const obj = {
  name: "èŠ±å­",
  arrow: () => { return <mark>this.name</mark>; }
};
obj.arrow(); // strictç’°å¢ƒã§ã¯ <mark>undefined</mark>`
  );

  // ã‚±ãƒ¼ã‚¹6: call()ã¨apply()ã§ã®thisæŒ‡å®š
  function sayHi() { return `Hi, ${this.name}`; }
  const user = { name: "Jiro" };
  
  // ã‚±ãƒ¼ã‚¹6-1: call()ãƒ¡ã‚½ãƒƒãƒ‰
  addCase(
    "6-1. call",
    `çµæœï¼š${sayHi.call(user)}ï¼ˆæœŸå¾…ã©ãŠã‚Šï¼‰`,
    "çµæœï¼šHi, Jiroï¼ˆæœŸå¾…ã©ãŠã‚Šï¼‰",
    "call/apply ã§æ˜ç¤ºçš„ã« this ã‚’æŒ‡å®šã§ãã‚‹ã€‚",
    `sayHi.call({ name: "Jiro" }); // <mark>"Hi, Jiro"</mark>`
  );
  
  // ã‚±ãƒ¼ã‚¹6-2: apply()ãƒ¡ã‚½ãƒƒãƒ‰
  addCase(
    "6-2. apply",
    `çµæœï¼š${sayHi.apply(user)}ï¼ˆæœŸå¾…ã©ãŠã‚Šï¼‰`,
    "çµæœï¼šHi, Jiroï¼ˆæœŸå¾…ã©ãŠã‚Šï¼‰",
    "apply ã§ã‚‚åŒæ§˜ã« this ã‚’æŒ‡å®šå¯èƒ½ã€‚",
    `sayHi.apply({ name: "Jiro" }); // <mark>"Hi, Jiro"</mark>`
  );

  // ===== ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯æ™‚ã®ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ =====
  
  // ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã‚’è¨­å®šï¼ˆä¸€åº¦ã ã‘å®Ÿè¡Œï¼‰
  btn.addEventListener("click", function handler(evt) {
    // ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ãƒ¼å†…ã®thisã‚’ä¿å­˜ï¼ˆã‚¢ãƒ­ãƒ¼é–¢æ•°ã§ä½¿ç”¨ã™ã‚‹ãŸã‚ï¼‰
    const btnThis = this;

    // ã‚±ãƒ¼ã‚¹7-1: é€šå¸¸é–¢æ•°ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ãƒ¼
    const div1 = addCase(
      "7-1. ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ãƒ¼ï¼ˆé€šå¸¸é–¢æ•°ï¼‰",
      `çµæœï¼š${btnThis.tagName}ï¼ˆæœŸå¾…ã©ãŠã‚Šï¼‰`,
      "çµæœï¼šBUTTONï¼ˆæœŸå¾…ã©ãŠã‚Šï¼‰",
      "é€šå¸¸é–¢æ•°ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ãƒ¼å†…ã® this ã¯ã‚¤ãƒ™ãƒ³ãƒˆã‚’å—ã‘å–ã£ãŸè¦ç´ ï¼ˆBUTTONï¼‰ã€‚",
      `document.getElementById("btn").addEventListener("click", function() {
  console.log(<mark>this.tagName</mark>); // "BUTTON"
});`
    );

    // ã‚±ãƒ¼ã‚¹7-2: ã‚¢ãƒ­ãƒ¼é–¢æ•°ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ãƒ¼
    const div2 = addCase(
      "7-2. ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ãƒ¼ï¼ˆã‚¢ãƒ­ãƒ¼é–¢æ•°ï¼‰",
      `çµæœï¼š${(() => btnThis.tagName)()}ï¼ˆæœŸå¾…ã©ãŠã‚Šï¼‰`,
      "çµæœï¼šBUTTONï¼ˆæœŸå¾…ã©ãŠã‚Šï¼‰",
      "ã‚¢ãƒ­ãƒ¼é–¢æ•°ã¯å¤–å´ã® this ã‚’ãã®ã¾ã¾ä½¿ã†ï¼ˆã“ã“ã§ã¯ BUTTONï¼‰ã€‚",
      `document.getElementById("btn").addEventListener("click", function() {
  (() => {
    console.log(<mark>this.tagName</mark>); // "BUTTON"
  })();
});`
    );

    // ã‚±ãƒ¼ã‚¹7-3: ãƒã‚¹ãƒˆã—ãŸé€šå¸¸é–¢æ•°
    const div3 = addCase(
      "7-3. ãƒã‚¹ãƒˆã—ãŸé€šå¸¸é–¢æ•°",
      (() => {
        try {
          return String((function() { return this; })());
        } catch(e) {
          return "ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿï¼š" + e.message;
        }
      })(),
      "undefined",
      "ãƒã‚¹ãƒˆã—ãŸé€šå¸¸é–¢æ•°ã¯å‘¼ã³å‡ºã—æ–¹ãŒã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆçµŒç”±ã§ãªã„ãŸã‚ strict ã§ã¯ undefinedã€‚",
      `document.getElementById("btn").addEventListener("click", function() {
  (function() {
    console.log(<mark>this</mark>); // undefined (strict)
  })();
});`
    );

    // ã‚±ãƒ¼ã‚¹7-4: ãƒã‚¹ãƒˆã—ãŸã‚¢ãƒ­ãƒ¼é–¢æ•°
    const div4 = addCase(
      "7-4. ãƒã‚¹ãƒˆã—ãŸã‚¢ãƒ­ãƒ¼é–¢æ•°",
      `çµæœï¼š${(() => btnThis.tagName)()}ï¼ˆæœŸå¾…ã©ãŠã‚Šï¼‰`,
      "çµæœï¼šBUTTONï¼ˆæœŸå¾…ã©ãŠã‚Šï¼‰",
      "ã‚¢ãƒ­ãƒ¼é–¢æ•°ã¯å¤–å´ã‚¹ã‚³ãƒ¼ãƒ—ï¼ˆã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ãƒ¼ï¼‰ã® this ã‚’ç¶™æ‰¿ã™ã‚‹ãŸã‚ BUTTONã€‚",
      `document.getElementById("btn").addEventListener("click", function() {
  (() => {
    console.log(<mark>this.tagName</mark>); // "BUTTON"
  })();
});`
    );

    // ãƒã‚¤ãƒ©ã‚¤ãƒˆã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œ
    [div1, div2, div3, div4].forEach(div => {
      const marks = div.querySelectorAll("mark");
      marks.forEach(m => {
        m.classList.add("highlight");
        setTimeout(() => m.classList.remove("highlight"), 1300);
      });
    });

    // ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–ï¼ˆä¸€åº¦ã ã‘å®Ÿè¡Œã™ã‚‹ãŸã‚ï¼‰
    btn.disabled = true;
  }, { once: true }); // once: true ã§ä¸€åº¦ã ã‘å®Ÿè¡Œ

});
</script>
</body>
</html>
